{
    "name": "tlsbl-unsafe-certificate-malware",
    "match_rules": [
        {
            "key": "type",
            "val": "tlsbl"
        },
        {
            "key": "name",
            "val": "UnsafeCertificate.malware"
        }
    ],
    "output": {
        "data": {
            "object_type": "behaviour",
            "object": {
                "src_mac": null,
                "src_ip": null,
                "src_port": null,
                "dst_mac": "",
                "dst_ip": null,
                "dst_port": null,
                "detection": null,
                "domain": null,
                "malware": null,
                "lan_initiated": true
            },
            "threat_type": "certificate",
            "threat_subtype": "unsafe",
            "threat": null,
            "blocked": null
        },
        "metadata": {
            "target_mac": null,
            "target_ip": null,
            "device_id": null,
            "service": "connect/seccenter",
            "method": "report_malware",
            "data_name": "threats",
            "app_id": null
        }
    },
    "action_rules": [
        {
            "key": "data.object.malware",
            "val": "get_array_element()",
            "params": [0, "$extra.threat"],
            "mandatory": true
        },
        {
            "key": "data.object.src_mac",
            "val": "$extra.src_mac",
            "mandatory": true
        },
        {
            "key": "data.object.src_ip",
            "val": "$extra.src_ip",
            "mandatory": true
        },
        {
            "key": "data.object.src_port",
            "val": "$extra.src_port",
            "mandatory": true
        },
        {
            "key": "data.object.dst_mac",
            "val": "$extra.dst_mac",
            "mandatory": false
        },
        {
            "key": "data.object.dst_ip",
            "val": "$extra.dst_ip",
            "mandatory": true
        },
        {
            "key": "data.object.dst_port",
            "val": "$extra.dst_port",
            "mandatory": true
        },
        {
            "key": "data.object.detection",
            "val": "concatenate()",
            "params": ["$type", ".", "$name"],
            "mandatory": true
        },
        {
            "key": "data.object.domain",
            "val": "$extra.http_host",
            "mandatory": true
        },
        {
            "key": "data.threat",
            "val": "$name",
            "mandatory": true
        },
        {
            "key": "data.blocked",
            "val": "was_blocked()",
            "params": ["$was_blocked"],
            "mandatory": true
        },
        {
            "key": "metadata.target_mac",
            "val": "$extra.src_mac",
            "mandatory": true
        },
        {
            "key": "metadata.target_ip",
            "val": "$extra.src_ip",
            "mandatory": true
        },
        {
            "key": "metadata.device_id",
            "val": "device_id()",
            "params": ["$extra.src_mac"],
            "mandatory": true
        },
        {
            "key": "metadata.app_id",
            "val": "app_id()",
            "params": [],
            "mandatory": true
        }
    ]
}
